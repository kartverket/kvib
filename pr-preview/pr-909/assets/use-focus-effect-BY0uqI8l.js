import{r as a}from"./index-BwDkhjyp.js";import{u as d}from"./use-event-listener-DbiM-QVt.js";import{g as b,a as F}from"./owner-DF4q1r8F.js";import{u as v}from"./use-safe-layout-effect-BnICyLBj.js";import{u as p}from"./use-update-effect-CNg9DBIF.js";import{g as E,i as h}from"./focusable-crJ8ziAt.js";function R(t){const{isOpen:n,ref:e}=t,[o,u]=a.useState(n),[r,s]=a.useState(!1);return a.useEffect(()=>{r||(u(n),s(!0))},[n,r,o]),d(()=>e.current,"animationend",()=>{u(n)}),{present:!(n?!1:!o),onComplete(){var i;const l=b(e.current),m=new l.CustomEvent("animationend",{bubbles:!0});(i=e.current)==null||i.dispatchEvent(m)}}}function S(t){const n=t.current;if(!n)return!1;const e=F(n);return!e||n.contains(e)?!1:!!h(e)}function V(t,n){const{shouldFocus:e,visible:o,focusRef:u}=n,r=e&&!o;p(()=>{if(!r||S(t))return;const s=(u==null?void 0:u.current)||t.current;let c;if(s)return c=requestAnimationFrame(()=>{s.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(c)}},[r,t,u])}const A={preventScroll:!0,shouldFocus:!1};function j(t,n=A){const{focusRef:e,preventScroll:o,shouldFocus:u,visible:r}=n,s=O(t)?t.current:t,c=u&&r,l=a.useRef(c),m=a.useRef(r);v(()=>{!m.current&&r&&(l.current=c),m.current=r},[r,c]);const i=a.useCallback(()=>{if(!(!r||!s||!l.current)&&(l.current=!1,!s.contains(document.activeElement)))if(e!=null&&e.current)requestAnimationFrame(()=>{var f;(f=e.current)==null||f.focus({preventScroll:o})});else{const f=E(s);f.length>0&&requestAnimationFrame(()=>{f[0].focus({preventScroll:o})})}},[r,o,s,e]);p(()=>{i()},[i]),d(s,"transitionend",i)}function O(t){return"current"in t}export{R as a,j as b,V as u};
