import{c as W}from"./index-D07EZmij.js";import{b as X,d as Y,e as Z,M as q,I as k,i as h,f as z,w as U,t as tt,g as et}from"./factory-CI2KYaro.js";import{r as s}from"./index-BqsZ9I6k.js";import{r as P}from"./index-B9Psn0MX.js";import"./jsx-runtime-D_zvdyIk.js";const[lt,dt]=W({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}});function rt(t){return new Proxy({},{get(o,c){return c==="style"?f=>t({style:f}).style:t}})}var gt=()=>t=>Array.from(new Set(t)),H=typeof globalThis.document<"u"?s.useLayoutEffect:s.useEffect;function j(t){const o=t().value??t().defaultValue,c=t().isEqual??Object.is,[f]=s.useState(o),[S,y]=s.useState(f),m=t().value!==void 0,x=s.useRef(S);x.current=m?t().value:S;const E=s.useRef(x.current);H(()=>{E.current=x.current},[S,t().value]);const b=g=>{var C,M;const i=E.current,l=z(g)?g(i):g;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:l,prev:i}),m||y(l),c(l,i)||(M=(C=t()).onChange)==null||M.call(C,l,i)};function w(){return m?t().value:S}return{initial:f,ref:x,get:w,set(g){(t().sync?P.flushSync:h)(()=>b(g))},invoke(g,i){var l,C;(C=(l=t()).onChange)==null||C.call(l,g,i)},hash(g){var i,l;return((l=(i=t()).hash)==null?void 0:l.call(i,g))??String(g)}}}j.cleanup=t=>{s.useEffect(()=>t,[])};j.ref=t=>{const o=s.useRef(t);return{get:()=>o.current,set:c=>{o.current=c}}};function nt(t){const o=s.useRef(t);return{get(c){return o.current[c]},set(c,f){o.current[c]=f}}}var ut=(t,o)=>{const c=s.useRef(!1),f=s.useRef(!1);s.useEffect(()=>{if(c.current&&f.current)return o();f.current=!0},[...(t??[]).map(S=>typeof S=="function"?S():S)]),s.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[])};function pt(t,o={}){var J,_,B,D;const c=s.useMemo(()=>{const{id:r,ids:e,getRootNode:n}=o;return X({id:r,ids:e,getRootNode:n})},[o]),f=(...r)=>{t.debug&&console.log(...r)},S=((J=t.props)==null?void 0:J.call(t,{props:Y(o),scope:c}))??o,y=st(S),m=(_=t.context)==null?void 0:_.call(t,{prop:y,bindable:j,scope:c,flush:G,getContext(){return E},getComputed(){return T},getRefs(){return M},getEvent(){return l()}}),x=K(m),E={get(r){var e;return(e=x.current)==null?void 0:e[r].ref.current},set(r,e){var n;(n=x.current)==null||n[r].set(e)},initial(r){var e;return(e=x.current)==null?void 0:e[r].initial},hash(r){var n,u;const e=(n=x.current)==null?void 0:n[r].get();return(u=x.current)==null?void 0:u[r].hash(e)}},b=s.useRef(new Map),w=s.useRef(null),g=s.useRef(null),i=s.useRef({type:""}),l=()=>({...i.current,current(){return i.current},previous(){return g.current}}),C=()=>({...p,matches(...r){return r.includes(p.ref.current)},hasTag(r){var e,n;return!!((n=(e=t.states[p.ref.current])==null?void 0:e.tags)!=null&&n.includes(r))}}),M=nt(((B=t.refs)==null?void 0:B.call(t,{prop:y,context:E}))??{}),N=()=>({state:C(),context:E,event:l(),prop:y,send:F,action:L,guard:$,track:ut,refs:M,computed:T,flush:G,scope:c,choose:I}),L=r=>{const e=z(r)?r(N()):r;if(!e)return;const n=e.map(u=>{var d,v;const a=(v=(d=t.implementations)==null?void 0:d.actions)==null?void 0:v[u];return a||U(`[zag-js] No implementation found for action "${JSON.stringify(u)}"`),a});for(const u of n)u==null||u(N())},$=r=>{var e,n;return z(r)?r(N()):(n=(e=t.implementations)==null?void 0:e.guards)==null?void 0:n[r](N())},A=r=>{const e=z(r)?r(N()):r;if(!e)return;const n=e.map(a=>{var v,R;const d=(R=(v=t.implementations)==null?void 0:v.effects)==null?void 0:R[a];return d||U(`[zag-js] No implementation found for effect "${JSON.stringify(a)}"`),d}),u=[];for(const a of n){const d=a==null?void 0:a(N());d&&u.push(d)}return()=>u.forEach(a=>a==null?void 0:a())},I=r=>tt(r).find(e=>{let n=!e.guard;return et(e.guard)?n=!!$(e.guard):z(e.guard)&&(n=e.guard(N())),n}),T=r=>{Z(t.computed,()=>"[zag-js] No computed object found on machine");const e=t.computed[r];return e({context:E,event:l(),prop:y,refs:M,scope:c,computed:T})},p=j(()=>({defaultValue:t.initialState({prop:y}),onChange(r,e){var u,a,d,v;if(e){const R=b.current.get(e);R==null||R(),b.current.delete(e)}e&&L((u=t.states[e])==null?void 0:u.exit),L((a=w.current)==null?void 0:a.actions);const n=A((d=t.states[r])==null?void 0:d.effects);if(n&&b.current.set(r,n),e===k){L(t.entry);const R=A(t.effects);R&&b.current.set(k,R)}L((v=t.states[r])==null?void 0:v.entry)}})),O=s.useRef(void 0),V=s.useRef(q.NotStarted);H(()=>{queueMicrotask(()=>{const n=V.current===q.Started;V.current=q.Started,f(n?"rehydrating...":"initializing...");const u=O.current??p.initial;p.invoke(u,n?p.get():k)});const r=b.current,e=p.ref.current;return()=>{f("unmounting..."),O.current=e,V.current=q.Stopped,r.forEach(n=>n==null?void 0:n()),b.current=new Map,w.current=null,queueMicrotask(()=>{L(t.exit)})}},[]);const Q=()=>"ref"in p?p.ref.current:p.get(),F=r=>{queueMicrotask(()=>{var v,R;if(V.current!==q.Started)return;g.current=i.current,i.current=r;let e=Q();const n=((v=t.states[e].on)==null?void 0:v[r.type])??((R=t.on)==null?void 0:R[r.type]),u=I(n);if(!u)return;w.current=u;const a=u.target??e;f("transition",r.type,u.target||e,`(${u.actions})`);const d=a!==e;d?P.flushSync(()=>p.set(a)):u.reenter&&!d?p.invoke(e,e):L(u.actions??[])})};return(D=t.watch)==null||D.call(t,N()),{state:C(),send:F,context:E,prop:y,scope:c,refs:M,computed:T,event:l(),getStatus:()=>V.current}}function K(t){const o=s.useRef(t);return o.current=t,o}function st(t){const o=K(t);return function(f){return o.current[f]}}function G(t){queueMicrotask(()=>{P.flushSync(()=>t())})}var Rt=rt(t=>t);export{lt as L,pt as a,gt as c,Rt as n,dt as u};
