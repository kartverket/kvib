import{f as h,r as E,s as B,w as O,l as f,u as I,x as D}from"./index-DXXQsaeK.js";import{t as A}from"./index-CkRjxV2T.js";import{j as b,w as k}from"./index-CxfNaWX6.js";import{b as M}from"./index-Dltf2pIY.js";function N(e,t){const r=i=>{i.key==="Escape"&&(i.isComposing||t==null||t(i))};return M(B(e),"keydown",r,{capture:!0})}var o={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){var i;const t=this.indexOf(e),r=this.topMostPointerBlockingLayer()?this.indexOf((i=this.topMostPointerBlockingLayer())==null?void 0:i.node):-1;return t<r},isTopMost(e){const t=this.layers[this.count()-1];return(t==null?void 0:t.node)===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},isInNestedLayer(e,t){return this.getNestedLayers(e).some(r=>h(r.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>h(t,e))},add(e){const t=this.layers.push(e);e.node.style.setProperty("--layer-index",`${t}`)},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(i=>i.dismiss()),this.layers.splice(t,1),e.style.removeProperty("--layer-index"))},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e){var t;(t=this.layers[this.indexOf(e)])==null||t.dismiss()},clear(){this.remove(this.layers[0].node)}},m;function g(){o.layers.forEach(({node:e})=>{e.style.pointerEvents=o.isBelowPointerBlockingLayer(e)?"none":"auto"})}function T(e){e.style.pointerEvents=""}function K(e,t){const r=B(e),i=[];if(o.hasPointerBlockingLayer()&&!r.body.hasAttribute("data-inert")&&(m=document.body.style.pointerEvents,queueMicrotask(()=>{r.body.style.pointerEvents="none",r.body.setAttribute("data-inert","")})),t){const a=O(t,s=>{i.push(D(s,{pointerEvents:"auto"}))});i.push(a)}return()=>{o.hasPointerBlockingLayer()||(queueMicrotask(()=>{r.body.style.pointerEvents=m,r.body.removeAttribute("data-inert"),r.body.style.length===0&&r.body.removeAttribute("style")}),i.forEach(a=>a()))}}function j(e,t){if(!e){k("[@zag-js/dismissable] node is `null` or `undefined`");return}const{onDismiss:r,pointerBlocking:i,exclude:a,debug:s}=t,p={dismiss:r,node:e,pointerBlocking:i};o.add(p),g();function P(n){var u,l;const c=f(n.detail.originalEvent);o.isBelowPointerBlockingLayer(e)||o.isInBranch(c)||((u=t.onPointerDownOutside)==null||u.call(t,n),(l=t.onInteractOutside)==null||l.call(t,n),!n.defaultPrevented&&(s&&console.log("onPointerDownOutside:",n.detail.originalEvent),r==null||r()))}function v(n){var u,l;const c=f(n.detail.originalEvent);o.isInBranch(c)||((u=t.onFocusOutside)==null||u.call(t,n),(l=t.onInteractOutside)==null||l.call(t,n),!n.defaultPrevented&&(s&&console.log("onFocusOutside:",n.detail.originalEvent),r==null||r()))}function x(n){var c;o.isTopMost(e)&&((c=t.onEscapeKeyDown)==null||c.call(t,n),!n.defaultPrevented&&r&&(n.preventDefault(),r()))}function L(n){var y;if(!e)return!1;const c=typeof a=="function"?a():a,u=Array.isArray(c)?c:[c],l=(y=t.persistentElements)==null?void 0:y.map(d=>d()).filter(I);return l&&u.push(...l),u.some(d=>h(d,n))||o.isInNestedLayer(e,n)}const w=[i?K(e,t.persistentElements):void 0,N(e,x),A(e,{exclude:L,onFocusOutside:v,onPointerDownOutside:P,defer:t.defer})];return()=>{o.remove(e),g(),T(e),w.forEach(n=>n==null?void 0:n())}}function S(e,t){const{defer:r}=t,i=r?E:s=>s(),a=[];return a.push(i(()=>{const s=b(e)?e():e;a.push(j(s,t))})),()=>{a.forEach(s=>s==null?void 0:s())}}function F(e,t={}){const{defer:r}=t,i=r?E:s=>s(),a=[];return a.push(i(()=>{const s=b(e)?e():e;if(!s){k("[@zag-js/dismissable] branch node is `null` or `undefined`");return}o.addBranch(s),a.push(()=>{o.removeBranch(s)})})),()=>{a.forEach(s=>s==null?void 0:s())}}export{F as a,S as t};
