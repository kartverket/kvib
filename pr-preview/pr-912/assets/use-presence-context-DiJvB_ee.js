import{a as E,y as p}from"./index-DussGwo5.js";import{c as f}from"./index-Ctx6eFvH.js";import{u as A}from"./index-D6fzw86p.js";import{r as v}from"./index-CcKhGcwW.js";import{u as y}from"./use-event-CSfbiBcH.js";import{c as O}from"./create-context-DPShtm6F.js";function P(o,e,t){const i=o.matches("mounted","unmountSuspended");return{skip:!o.context.initial&&i,present:i,setNode(n){n&&e({type:"NODE.SET",node:n})},unmount(){e({type:"UNMOUNT"})}}}function U(o){return E({initial:o.present?"mounted":"unmounted",context:{node:null,styles:null,unmountAnimationName:null,prevAnimationName:null,present:!1,initial:!1,...o},exit:["clearInitial"],watch:{present:["setInitial","syncPresence"]},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]},"UNMOUNT.SUSPEND":"unmountSuspended"}},unmountSuspended:{activities:["trackAnimationEvents"],after:{ANIMATION_DURATION:{target:"unmounted",actions:["invokeOnExitComplete"]}},on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]}}},unmounted:{entry:["clearPrevAnimationName"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}}},{delays:{ANIMATION_DURATION(e){var t,i;return N((t=e.styles)==null?void 0:t.animationDuration)+N((i=e.styles)==null?void 0:i.animationDelay)+M}},actions:{setInitial(e){e.initial=!0},clearInitial(e){e.initial=!1},invokeOnExitComplete(e){var t;(t=e.onExitComplete)==null||t.call(e)},setNode(e,t){e.node=p(t.node)},setStyles(e,t){const i=t.node.ownerDocument.defaultView||window;e.styles=p(i.getComputedStyle(t.node))},syncPresence(e,t,{send:i}){var s;if(e.present){i({type:"MOUNT",src:"presence.changed"});return}if(!e.present&&((s=e.node)==null?void 0:s.ownerDocument.visibilityState)==="hidden"){i({type:"UNMOUNT",src:"visibilitychange"});return}const n=l(e.styles);(e.immediate?queueMicrotask:requestAnimationFrame)(()=>{var a,r;e.unmountAnimationName=n,n==="none"||n===e.prevAnimationName||((a=e.styles)==null?void 0:a.display)==="none"||((r=e.styles)==null?void 0:r.animationDuration)==="0s"?i({type:"UNMOUNT",src:"presence.changed"}):i({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName(e){(e.immediate?queueMicrotask:requestAnimationFrame)(()=>{e.prevAnimationName=l(e.styles)})},clearPrevAnimationName(e){e.prevAnimationName=null}},activities:{trackAnimationEvents(e,t,{send:i}){const n=e.node;if(!n)return;const u=a=>{var c,m;(((m=(c=a.composedPath)==null?void 0:c.call(a))==null?void 0:m[0])??a.target)===n&&(e.prevAnimationName=l(e.styles))},s=a=>{var m,d;const r=l(e.styles);(((d=(m=a.composedPath)==null?void 0:m.call(a))==null?void 0:d[0])??a.target)===n&&r===e.unmountAnimationName&&i({type:"UNMOUNT",src:"animationend"})};return n.addEventListener("animationstart",u),n.addEventListener("animationcancel",s),n.addEventListener("animationend",s),()=>{n.removeEventListener("animationstart",u),n.removeEventListener("animationcancel",s),n.removeEventListener("animationend",s)}}}})}function l(o){return(o==null?void 0:o.animationName)||"none"}function N(o){return parseFloat(o||"0")*1e3}var M=16.667;f()(["onExitComplete","present","immediate"]);const D=o=>{const{lazyMount:e,unmountOnExit:t,...i}=o,n=v.useRef(!1),u={...i,onExitComplete:y(o.onExitComplete)},[s,a]=A(U(u),{context:u}),r=P(s,a);r.present&&(n.current=!0);const c=!r.present&&!n.current&&e||t&&!r.present&&n.current,m=()=>({"data-state":o.present?"open":"closed",hidden:!r.present});return{ref:r.setNode,getPresenceProps:m,present:r.present,unmounted:c}},[k,w]=O({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});export{k as P,w as a,D as u};
