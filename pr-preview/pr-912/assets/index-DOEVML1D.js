import{c as R}from"./index-BRNWFSEf.js";import{c as T,d,E as h,f as y,v as b,r as A,l as v}from"./index-DXXQsaeK.js";import{f as w}from"./index-DC8FWG5U.js";import{c as D}from"./index-Ctx6eFvH.js";import{c as N,a as S,y as f}from"./index-CxfNaWX6.js";function C(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function j(e){return/^.*\.[\w]+$/.test(e)}var O=e=>C(e)||j(e);function z(e){if(e)return typeof e=="string"?e:Array.isArray(e)?e.filter(O).join(","):Object.entries(e).reduce((i,[t,r])=>[...i,t,...r],[]).filter(O).join(",")}var _=(e,i)=>e.name===i.name&&e.size===i.size&&e.type===i.type,I=e=>e!=null;function k(e,i,t){if(I(e.size))if(I(i)&&I(t)){if(e.size>t)return[!1,"FILE_TOO_LARGE"];if(e.size<i)return[!1,"FILE_TOO_SMALL"]}else{if(I(i)&&e.size<i)return[!1,"FILE_TOO_SMALL"];if(I(t)&&e.size>t)return[!1,"FILE_TOO_LARGE"]}return[!0,null]}function $(e,i){if(e&&i){const t=Array.isArray(i)?i:i.split(","),r=e.name||"",a=(e.type||"").toLowerCase(),l=a.replace(/\/.*$/,"");return t.some(c=>{const p=c.trim().toLowerCase();return p.charAt(0)==="."?r.toLowerCase().endsWith(p):p.endsWith("/*")?l===p.replace(/\/.*$/,""):a===p})}return!0}function Z(e,i){const t=e.type==="application/x-moz-file"||$(e,i);return[t,t?null:"FILE_INVALID_TYPE"]}var G=R("file-upload").parts("root","dropzone","item","itemDeleteTrigger","itemGroup","itemName","itemPreview","itemPreviewImage","itemSizeText","label","trigger","clearTrigger"),g=G.build(),s=T({getRootId:e=>{var i;return((i=e.ids)==null?void 0:i.root)??`file:${e.id}`},getDropzoneId:e=>{var i;return((i=e.ids)==null?void 0:i.dropzone)??`file:${e.id}:dropzone`},getHiddenInputId:e=>{var i;return((i=e.ids)==null?void 0:i.hiddenInput)??`file:${e.id}:input`},getTriggerId:e=>{var i;return((i=e.ids)==null?void 0:i.trigger)??`file:${e.id}:trigger`},getLabelId:e=>{var i;return((i=e.ids)==null?void 0:i.label)??`file:${e.id}:label`},getItemId:(e,i)=>{var t,r;return((r=(t=e.ids)==null?void 0:t.item)==null?void 0:r.call(t,i))??`file:${e.id}:item:${i}`},getItemNameId:(e,i)=>{var t,r;return((r=(t=e.ids)==null?void 0:t.itemName)==null?void 0:r.call(t,i))??`file:${e.id}:item-name:${i}`},getItemSizeTextId:(e,i)=>{var t,r;return((r=(t=e.ids)==null?void 0:t.itemSizeText)==null?void 0:r.call(t,i))??`file:${e.id}:item-size:${i}`},getItemPreviewId:(e,i)=>{var t,r;return((r=(t=e.ids)==null?void 0:t.itemPreview)==null?void 0:r.call(t,i))??`file:${e.id}:item-preview:${i}`},getHiddenInputEl:e=>s.getById(e,s.getHiddenInputId(e)),getDropzoneEl:e=>s.getById(e,s.getDropzoneId(e))});function L(e){const i=v(e);return e.dataTransfer?e.dataTransfer.types.some(t=>t==="Files"||t==="application/x-moz-file"):!!i&&"files"in i}function M(e,i){return!e.multiple&&i>1?!1:!e.multiple&&i+e.acceptedFiles.length===2?!0:!(i+e.acceptedFiles.length>e.maxFiles)}function H(e,i){const t=[],r=[];return i.forEach(a=>{var m;const[l,c]=Z(a,e.acceptAttr),[p,n]=k(a,e.minFileSize,e.maxFileSize),o=(m=e.validate)==null?void 0:m.call(e,a),u=o?o.length===0:!0;if(l&&p&&u)t.push(a);else{const E=[c,n];u||E.push(...o??[]),r.push({file:a,errors:E.filter(Boolean)})}}),M(e,t.length)||(t.forEach(a=>{r.push({file:a,errors:["TOO_MANY_FILES"]})}),t.splice(0)),{acceptedFiles:t,rejectedFiles:r}}function q(e,i,t){const r=e.context.disabled,a=e.context.allowDrop,l=e.context.translations,c=e.matches("dragging"),p=e.matches("focused")&&!r;return{dragging:c,focused:p,openFilePicker(){i("OPEN")},deleteFile(n){i({type:"FILE.DELETE",file:n})},acceptedFiles:e.context.acceptedFiles,rejectedFiles:e.context.rejectedFiles,setFiles(n){const o=n.length;i({type:"FILES.SET",files:n,count:o})},clearRejectedFiles(){i({type:"REJECTED_FILES.CLEAR"})},clearFiles(){i({type:"FILES.CLEAR"})},getFileSize(n){return w(n.size,e.context.locale)},createFileUrl(n,o){const u=s.getWin(e.context),m=u.URL.createObjectURL(n);return o(m),()=>u.URL.revokeObjectURL(m)},getRootProps(){return t.element({...g.root.attrs,dir:e.context.dir,id:s.getRootId(e.context),"data-disabled":d(r),"data-dragging":d(c)})},getDropzoneProps(){return t.element({...g.dropzone.attrs,dir:e.context.dir,id:s.getDropzoneId(e.context),tabIndex:r?void 0:0,role:"button","aria-label":l.dropzone,"aria-disabled":r,"data-invalid":d(e.context.invalid),"data-disabled":d(r),"data-dragging":d(c),onKeyDown(n){n.defaultPrevented||h(n)&&(n.key!=="Enter"&&n.key!==" "||i({type:"DROPZONE.CLICK",src:"keydown"}))},onClick(n){n.currentTarget.localName==="label"&&n.preventDefault(),i("DROPZONE.CLICK")},onDragOver(n){if(!a)return;n.preventDefault(),n.stopPropagation();try{n.dataTransfer.dropEffect="copy"}catch{}if(!L(n))return;const u=n.dataTransfer.items.length;i({type:"DROPZONE.DRAG_OVER",count:u})},onDragLeave(n){!a||r||y(n.currentTarget,n.relatedTarget)||i({type:"DROPZONE.DRAG_LEAVE"})},onDrop(n){a&&(n.preventDefault(),n.stopPropagation());const o=L(n);r||!o||i({type:"DROPZONE.DROP",files:Array.from(n.dataTransfer.files)})},onFocus(){i("DROPZONE.FOCUS")},onBlur(){i("DROPZONE.BLUR")}})},getTriggerProps(){return t.button({...g.trigger.attrs,dir:e.context.dir,id:s.getTriggerId(e.context),disabled:r,"data-disabled":d(r),"data-invalid":d(e.context.invalid),type:"button",onClick(n){r||(y(s.getDropzoneEl(e.context),n.currentTarget)&&n.stopPropagation(),i("OPEN"))}})},getHiddenInputProps(){return t.input({id:s.getHiddenInputId(e.context),tabIndex:-1,disabled:r,type:"file",required:e.context.required,capture:e.context.capture,name:e.context.name,accept:e.context.acceptAttr,webkitdirectory:e.context.directory?"":void 0,multiple:e.context.multiple||e.context.maxFiles>1,onClick(n){n.stopPropagation(),n.currentTarget.value=""},onChange(n){if(r)return;const{files:o}=n.currentTarget;i({type:"FILES.SET",files:o?Array.from(o):[]})},style:b})},getItemGroupProps(){return t.element({...g.itemGroup.attrs,dir:e.context.dir,"data-disabled":d(r)})},getItemProps(n){const{file:o}=n;return t.element({...g.item.attrs,dir:e.context.dir,id:s.getItemId(e.context,o.name),"data-disabled":d(r)})},getItemNameProps(n){const{file:o}=n;return t.element({...g.itemName.attrs,dir:e.context.dir,id:s.getItemNameId(e.context,o.name),"data-disabled":d(r)})},getItemSizeTextProps(n){const{file:o}=n;return t.element({...g.itemSizeText.attrs,dir:e.context.dir,id:s.getItemSizeTextId(e.context,o.name),"data-disabled":d(r)})},getItemPreviewProps(n){const{file:o}=n;return t.element({...g.itemPreview.attrs,dir:e.context.dir,id:s.getItemPreviewId(e.context,o.name),"data-disabled":d(r)})},getItemPreviewImageProps(n){var E;const{file:o,url:u}=n;if(!o.type.startsWith("image/"))throw new Error("Preview Image is only supported for image files");return t.img({...g.itemPreviewImage.attrs,alt:(E=l.itemPreview)==null?void 0:E.call(l,o),src:u,"data-disabled":d(r)})},getItemDeleteTriggerProps(n){var u;const{file:o}=n;return t.button({...g.itemDeleteTrigger.attrs,dir:e.context.dir,type:"button",disabled:r,"data-disabled":d(r),"aria-label":(u=l.deleteFile)==null?void 0:u.call(l,o),onClick(){r||i({type:"FILE.DELETE",file:o})}})},getLabelProps(){return t.label({...g.label.attrs,dir:e.context.dir,id:s.getLabelId(e.context),htmlFor:s.getHiddenInputId(e.context),"data-disabled":d(r)})},getClearTriggerProps(){return t.button({...g.clearTrigger.attrs,dir:e.context.dir,type:"button",disabled:r,hidden:e.context.acceptedFiles.length===0,"data-disabled":d(r),onClick(n){n.defaultPrevented||r||i({type:"FILES.CLEAR"})}})}}}function x(e){const i=N(e);return S({id:"fileupload",initial:"idle",context:{minFileSize:0,maxFileSize:1/0,maxFiles:1,allowDrop:!0,...i,acceptedFiles:f([]),rejectedFiles:f([]),translations:{dropzone:"dropzone",itemPreview:t=>`preview of ${t.name}`,deleteFile:t=>`delete file ${t.name}`,...i.translations}},computed:{acceptAttr:t=>z(t.accept),multiple:t=>t.maxFiles>1},on:{"FILES.SET":{actions:["setFilesFromEvent"]},"FILE.DELETE":{actions:["removeFile"]},"FILES.CLEAR":{actions:["clearFiles"]},"REJECTED_FILES.CLEAR":{actions:["clearRejectedFiles"]}},states:{idle:{on:{OPEN:{actions:["openFilePicker"]},"DROPZONE.CLICK":{actions:["openFilePicker"]},"DROPZONE.FOCUS":"focused","DROPZONE.DRAG_OVER":{target:"dragging"}}},focused:{on:{"DROPZONE.BLUR":"idle",OPEN:{actions:["openFilePicker"]},"DROPZONE.CLICK":{actions:["openFilePicker"]},"DROPZONE.DRAG_OVER":{target:"dragging"}}},dragging:{on:{"DROPZONE.DROP":{target:"idle",actions:["setFilesFromEvent","syncInputElement"]},"DROPZONE.DRAG_LEAVE":{target:"idle"}}}}},{actions:{syncInputElement(t){const r=s.getHiddenInputEl(t);if(!r)return;const a=s.getWin(t),l=new a.DataTransfer;t.acceptedFiles.forEach(c=>{l.items.add(c)}),r.files=l.files},openFilePicker(t){A(()=>{var r;(r=s.getHiddenInputEl(t))==null||r.click()})},setFilesFromEvent(t,r){const a=H(t,r.files),{acceptedFiles:l,rejectedFiles:c}=a;if(t.multiple){const p=f([...t.acceptedFiles,...l]);P.files(t,p,c);return}if(l.length){const p=f([l[0]]);P.files(t,p,c)}else c.length&&P.files(t,t.acceptedFiles,c)},removeFile(t,r){const a=t.acceptedFiles.filter(l=>l!==r.file);t.acceptedFiles=f(a),F.change(t)},clearRejectedFiles(t){t.rejectedFiles=f([]),F.change(t)},clearFiles(t){t.acceptedFiles=f([]),t.rejectedFiles=f([]),F.change(t)}},compareFns:{acceptedFiles:(t,r)=>t.length===r.length&&t.every((a,l)=>_(a,r[l]))}})}var F={change:e=>{var i;(i=e.onFileChange)==null||i.call(e,{acceptedFiles:e.acceptedFiles,rejectedFiles:e.rejectedFiles})},accept:e=>{var i;(i=e.onFileAccept)==null||i.call(e,{files:e.acceptedFiles})},reject:e=>{var i;(i=e.onFileReject)==null||i.call(e,{files:e.rejectedFiles})}},P={files:(e,i,t)=>{e.acceptedFiles=f(i),F.accept(e),t&&(e.rejectedFiles=f(t),F.reject(e)),F.change(e)}};D()(["accept","allowDrop","capture","dir","directory","disabled","getRootNode","id","ids","locale","maxFiles","maxFileSize","minFileSize","name","invalid","onFileAccept","onFileReject","onFileChange","required","translations","validate"]);D()(["file"]);export{G as a,q as c,x as m};
