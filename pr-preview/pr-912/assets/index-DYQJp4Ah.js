import{K as E,L as B,z as h,r as b,M as w,N as k,O as I,I as f,P as D,Q as M}from"./create-slot-recipe-context-BTQZ2sOO.js";import{t as A}from"./index-P9vquDP9.js";function N(e,t){const r=i=>{i.key==="Escape"&&(i.isComposing||t==null||t(i))};return w(k(e),"keydown",r,{capture:!0})}var c={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){var i;const t=this.indexOf(e),r=this.topMostPointerBlockingLayer()?this.indexOf((i=this.topMostPointerBlockingLayer())==null?void 0:i.node):-1;return t<r},isTopMost(e){const t=this.layers[this.count()-1];return(t==null?void 0:t.node)===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},isInNestedLayer(e,t){return this.getNestedLayers(e).some(r=>h(r.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>h(t,e))},add(e){const t=this.layers.push(e);e.node.style.setProperty("--layer-index",`${t}`)},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(i=>i.dismiss()),this.layers.splice(t,1),e.style.removeProperty("--layer-index"))},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e){var t;(t=this.layers[this.indexOf(e)])==null||t.dismiss()},clear(){this.remove(this.layers[0].node)}},g;function m(){c.layers.forEach(({node:e})=>{e.style.pointerEvents=c.isBelowPointerBlockingLayer(e)?"none":"auto"})}function K(e){e.style.pointerEvents=""}function T(e,t){const r=k(e),i=[];if(c.hasPointerBlockingLayer()&&!r.body.hasAttribute("data-inert")&&(g=document.body.style.pointerEvents,queueMicrotask(()=>{r.body.style.pointerEvents="none",r.body.setAttribute("data-inert","")})),t){const a=I(t,s=>{i.push(M(s,{pointerEvents:"auto"}))});i.push(a)}return()=>{c.hasPointerBlockingLayer()||(queueMicrotask(()=>{r.body.style.pointerEvents=g,r.body.removeAttribute("data-inert"),r.body.style.length===0&&r.body.removeAttribute("style")}),i.forEach(a=>a()))}}function z(e,t){if(!e){B("[@zag-js/dismissable] node is `null` or `undefined`");return}const{onDismiss:r,pointerBlocking:i,exclude:a,debug:s}=t,P={dismiss:r,node:e,pointerBlocking:i};c.add(P),m();function p(n){var u,l;const o=f(n.detail.originalEvent);c.isBelowPointerBlockingLayer(e)||c.isInBranch(o)||((u=t.onPointerDownOutside)==null||u.call(t,n),(l=t.onInteractOutside)==null||l.call(t,n),!n.defaultPrevented&&(s&&console.log("onPointerDownOutside:",n.detail.originalEvent),r==null||r()))}function L(n){var u,l;const o=f(n.detail.originalEvent);c.isInBranch(o)||((u=t.onFocusOutside)==null||u.call(t,n),(l=t.onInteractOutside)==null||l.call(t,n),!n.defaultPrevented&&(s&&console.log("onFocusOutside:",n.detail.originalEvent),r==null||r()))}function v(n){var o;c.isTopMost(e)&&((o=t.onEscapeKeyDown)==null||o.call(t,n),!n.defaultPrevented&&r&&(n.preventDefault(),r()))}function x(n){var y;if(!e)return!1;const o=typeof a=="function"?a():a,u=Array.isArray(o)?o:[o],l=(y=t.persistentElements)==null?void 0:y.map(d=>d()).filter(D);return l&&u.push(...l),u.some(d=>h(d,n))||c.isInNestedLayer(e,n)}const O=[i?T(e,t.persistentElements):void 0,N(e,v),A(e,{exclude:x,onFocusOutside:L,onPointerDownOutside:p,defer:t.defer})];return()=>{c.remove(e),m(),K(e),O.forEach(n=>n==null?void 0:n())}}function j(e,t){const{defer:r}=t,i=r?b:s=>s(),a=[];return a.push(i(()=>{const s=E(e)?e():e;a.push(z(s,t))})),()=>{a.forEach(s=>s==null?void 0:s())}}function q(e,t={}){const{defer:r}=t,i=r?b:s=>s(),a=[];return a.push(i(()=>{const s=E(e)?e():e;if(!s){B("[@zag-js/dismissable] branch node is `null` or `undefined`");return}c.addBranch(s),a.push(()=>{c.removeBranch(s)})})),()=>{a.forEach(s=>s==null?void 0:s())}}export{q as a,j as t};
