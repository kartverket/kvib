import{c as E}from"./index-BRNWFSEf.js";import{c as O,h as m,j as I,d as C,p as P,n as T,r as g,k as p}from"./index-DXXQsaeK.js";import{g as f,a as u}from"./index-5IigYcSb.js";import{a as v,p as F,c as y}from"./focus-trap.esm-LvC8KysD.js";import{c as b,a as h}from"./index-CxfNaWX6.js";import{t as D}from"./index-ijNPfJJu.js";import{c as k}from"./index-Ctx6eFvH.js";var w=E("popover").parts("arrow","arrowTip","anchor","trigger","indicator","positioner","content","title","description","closeTrigger"),d=w.build(),o=O({getAnchorId:t=>{var r;return((r=t.ids)==null?void 0:r.anchor)??`popover:${t.id}:anchor`},getTriggerId:t=>{var r;return((r=t.ids)==null?void 0:r.trigger)??`popover:${t.id}:trigger`},getContentId:t=>{var r;return((r=t.ids)==null?void 0:r.content)??`popover:${t.id}:content`},getPositionerId:t=>{var r;return((r=t.ids)==null?void 0:r.positioner)??`popover:${t.id}:popper`},getArrowId:t=>{var r;return((r=t.ids)==null?void 0:r.arrow)??`popover:${t.id}:arrow`},getTitleId:t=>{var r;return((r=t.ids)==null?void 0:r.title)??`popover:${t.id}:title`},getDescriptionId:t=>{var r;return((r=t.ids)==null?void 0:r.description)??`popover:${t.id}:desc`},getCloseTriggerId:t=>{var r;return((r=t.ids)==null?void 0:r.closeTrigger)??`popover:${t.id}:close`},getAnchorEl:t=>o.getById(t,o.getAnchorId(t)),getTriggerEl:t=>o.getById(t,o.getTriggerId(t)),getContentEl:t=>o.getById(t,o.getContentId(t)),getPositionerEl:t=>o.getById(t,o.getPositionerId(t)),getTitleEl:t=>o.getById(t,o.getTitleId(t)),getDescriptionEl:t=>o.getById(t,o.getDescriptionId(t)),getFocusableEls:t=>m(o.getContentEl(t)),getFirstFocusableEl:t=>o.getFocusableEls(t)[0]});function $(t,r,e){const n=t.matches("open"),i=t.context.currentPlacement,c=t.context.currentPortalled,a=t.context.renderedElements,l=f({...t.context.positioning,placement:i});return{portalled:c,open:n,setOpen(s){s!==n&&r(s?"OPEN":"CLOSE")},reposition(s={}){r({type:"POSITIONING.SET",options:s})},getArrowProps(){return e.element({id:o.getArrowId(t.context),...d.arrow.attrs,dir:t.context.dir,style:l.arrow})},getArrowTipProps(){return e.element({...d.arrowTip.attrs,dir:t.context.dir,style:l.arrowTip})},getAnchorProps(){return e.element({...d.anchor.attrs,dir:t.context.dir,id:o.getAnchorId(t.context)})},getTriggerProps(){return e.button({...d.trigger.attrs,dir:t.context.dir,type:"button","data-placement":i,id:o.getTriggerId(t.context),"aria-haspopup":"dialog","aria-expanded":n,"data-state":n?"open":"closed","aria-controls":o.getContentId(t.context),onPointerDown(s){I()&&s.currentTarget.focus()},onClick(s){s.defaultPrevented||r("TOGGLE")},onBlur(s){r({type:"TRIGGER_BLUR",target:s.relatedTarget})}})},getIndicatorProps(){return e.element({...d.indicator.attrs,dir:t.context.dir,"data-state":n?"open":"closed"})},getPositionerProps(){return e.element({id:o.getPositionerId(t.context),...d.positioner.attrs,dir:t.context.dir,style:l.floating})},getContentProps(){return e.element({...d.content.attrs,dir:t.context.dir,id:o.getContentId(t.context),tabIndex:-1,role:"dialog",hidden:!n,"data-state":n?"open":"closed","data-expanded":C(n),"aria-labelledby":a.title?o.getTitleId(t.context):void 0,"aria-describedby":a.description?o.getDescriptionId(t.context):void 0,"data-placement":i})},getTitleProps(){return e.element({...d.title.attrs,id:o.getTitleId(t.context),dir:t.context.dir})},getDescriptionProps(){return e.element({...d.description.attrs,id:o.getDescriptionId(t.context),dir:t.context.dir})},getCloseTriggerProps(){return e.button({...d.closeTrigger.attrs,dir:t.context.dir,id:o.getCloseTriggerId(t.context),type:"button","aria-label":"close",onClick(s){s.defaultPrevented||r("CLOSE")}})}}}function K(t){const r=b(t);return h({id:"popover",initial:r.open?"open":"closed",context:{closeOnInteractOutside:!0,closeOnEscape:!0,autoFocus:!0,modal:!1,portalled:!0,positioning:{placement:"bottom",...r.positioning},currentPlacement:void 0,...r,renderedElements:{title:!0,description:!0}},computed:{currentPortalled:e=>!!e.modal||!!e.portalled},watch:{open:["toggleVisibility"]},entry:["checkRenderedElements"],states:{closed:{on:{"CONTROLLED.OPEN":{target:"open",actions:["setInitialFocus"]},TOGGLE:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen","setInitialFocus"]}],OPEN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen","setInitialFocus"]}]}},open:{activities:["trapFocus","preventScroll","hideContentBelow","trackPositioning","trackDismissableElement","proxyTabFocus"],on:{"CONTROLLED.CLOSE":{target:"closed",actions:["setFinalFocus"]},CLOSE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose","setFinalFocus"]}],TOGGLE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"POSITIONING.SET":{actions:"reposition"}}}}},{guards:{isOpenControlled:e=>!!e["open.controlled"]},activities:{trackPositioning(e){e.currentPlacement=e.positioning.placement;const n=o.getAnchorEl(e)??o.getTriggerEl(e);return u(n,()=>o.getPositionerEl(e),{...e.positioning,defer:!0,onComplete(c){e.currentPlacement=c.placement}})},trackDismissableElement(e,n,{send:i}){const c=()=>o.getContentEl(e);let a=!0;return D(c,{pointerBlocking:e.modal,exclude:o.getTriggerEl(e),defer:!0,onEscapeKeyDown(l){var s;(s=e.onEscapeKeyDown)==null||s.call(e,l),!e.closeOnEscape&&l.preventDefault()},onInteractOutside(l){var s;(s=e.onInteractOutside)==null||s.call(e,l),!l.defaultPrevented&&(a=!(l.detail.focusable||l.detail.contextmenu),e.closeOnInteractOutside||l.preventDefault())},onPointerDownOutside:e.onPointerDownOutside,onFocusOutside:e.onFocusOutside,persistentElements:e.persistentElements,onDismiss(){i({type:"CLOSE",src:"interact-outside",restoreFocus:a})}})},proxyTabFocus(e){return e.modal||!e.portalled?void 0:P(()=>o.getContentEl(e),{triggerElement:o.getTriggerEl(e),defer:!0,onFocus(i){i.focus({preventScroll:!0})}})},hideContentBelow(e){return e.modal?v(()=>[o.getContentEl(e),o.getTriggerEl(e)],{defer:!0}):void 0},preventScroll(e){if(e.modal)return F(o.getDoc(e))},trapFocus(e){if(!e.modal)return;let n;return T(()=>{const i=o.getContentEl(e);if(i){n=y(i,{escapeDeactivates:!1,allowOutsideClick:!0,preventScroll:!0,returnFocusOnDeactivate:!0,document:o.getDoc(e),fallbackFocus:i,initialFocus:p({root:o.getContentEl(e),getInitialEl:e.initialFocusEl,enabled:e.autoFocus})});try{n.activate()}catch{}}}),()=>n==null?void 0:n.deactivate()}},actions:{reposition(e,n){const i=o.getAnchorEl(e)??o.getTriggerEl(e);u(i,()=>o.getPositionerEl(e),{...e.positioning,...n.options,defer:!0,listeners:!1,onComplete(a){e.currentPlacement=a.placement}})},checkRenderedElements(e){g(()=>{Object.assign(e.renderedElements,{title:!!o.getTitleEl(e),description:!!o.getDescriptionEl(e)})})},setInitialFocus(e){e.modal||g(()=>{const n=p({root:o.getContentEl(e),getInitialEl:e.initialFocusEl,enabled:e.autoFocus});n==null||n.focus({preventScroll:!0})})},setFinalFocus(e,n){var c;const i=n.restoreFocus??((c=n.previousEvent)==null?void 0:c.restoreFocus);i!=null&&!i||g(()=>{const a=o.getTriggerEl(e);a==null||a.focus({preventScroll:!0})})},invokeOnOpen(e){var n;(n=e.onOpenChange)==null||n.call(e,{open:!0})},invokeOnClose(e){var n;(n=e.onOpenChange)==null||n.call(e,{open:!1})},toggleVisibility(e,n,{send:i}){i({type:e.open?"CONTROLLED.OPEN":"CONTROLLED.CLOSE",previousEvent:n})}}})}k()(["autoFocus","closeOnEscape","closeOnInteractOutside","dir","getRootNode","id","ids","initialFocusEl","modal","onEscapeKeyDown","onFocusOutside","onInteractOutside","onOpenChange","onPointerDownOutside","open.controlled","open","persistentElements","portalled","positioning"]);export{w as a,$ as c,K as m};
