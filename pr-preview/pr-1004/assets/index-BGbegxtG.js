import{c as W}from"./create-context-Dx5LeRZQ.js";import{b as X,d as Y,e as Z,M as q,I as k,i as h,f as z,w as U,t as tt,g as et}from"./factory-OQRc9M2v.js";import{r as s}from"./index-Bj2TM2QZ.js";import{r as P}from"./index-CVNl4AZj.js";import"./jsx-runtime-D_zvdyIk.js";const[lt,dt]=W({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}});function rt(t){return new Proxy({},{get(o,c){return c==="style"?f=>t({style:f}).style:t}})}var gt=()=>t=>Array.from(new Set(t)),H=typeof globalThis.document<"u"?s.useLayoutEffect:s.useEffect;function j(t){const o=t().value??t().defaultValue,c=t().isEqual??Object.is,[f]=s.useState(o),[S,y]=s.useState(f),m=t().value!==void 0,v=s.useRef(S);v.current=m?t().value:S;const b=s.useRef(v.current);H(()=>{b.current=v.current},[S,t().value]);const E=g=>{var C,M;const i=b.current,l=z(g)?g(i):g;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:l,prev:i}),m||y(l),c(l,i)||(M=(C=t()).onChange)==null||M.call(C,l,i)};function w(){return m?t().value:S}return{initial:f,ref:v,get:w,set(g){(t().sync?P.flushSync:h)(()=>E(g))},invoke(g,i){var l,C;(C=(l=t()).onChange)==null||C.call(l,g,i)},hash(g){var i,l;return((l=(i=t()).hash)==null?void 0:l.call(i,g))??String(g)}}}j.cleanup=t=>{s.useEffect(()=>t,[])};j.ref=t=>{const o=s.useRef(t);return{get:()=>o.current,set:c=>{o.current=c}}};function nt(t){const o=s.useRef(t);return{get(c){return o.current[c]},set(c,f){o.current[c]=f}}}var ut=(t,o)=>{const c=s.useRef(!1),f=s.useRef(!1);s.useEffect(()=>{if(c.current&&f.current)return o();f.current=!0},[...(t??[]).map(S=>typeof S=="function"?S():S)]),s.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[])};function Rt(t,o={}){var J,_,B,D;const c=s.useMemo(()=>{const{id:r,ids:e,getRootNode:n}=o;return X({id:r,ids:e,getRootNode:n})},[o]),f=(...r)=>{t.debug&&console.log(...r)},S=((J=t.props)==null?void 0:J.call(t,{props:Y(o),scope:c}))??o,y=st(S),m=(_=t.context)==null?void 0:_.call(t,{prop:y,bindable:j,scope:c,flush:G,getContext(){return b},getComputed(){return T},getRefs(){return M}}),v=K(m),b={get(r){var e;return(e=v.current)==null?void 0:e[r].ref.current},set(r,e){var n;(n=v.current)==null||n[r].set(e)},initial(r){var e;return(e=v.current)==null?void 0:e[r].initial},hash(r){var n,u;const e=(n=v.current)==null?void 0:n[r].get();return(u=v.current)==null?void 0:u[r].hash(e)}},E=s.useRef(new Map),w=s.useRef(null),g=s.useRef(null),i=s.useRef({type:""}),l=()=>({...i.current,current(){return i.current},previous(){return g.current}}),C=()=>({...R,matches(...r){return r.includes(R.ref.current)},hasTag(r){var e,n;return!!((n=(e=t.states[R.ref.current])==null?void 0:e.tags)!=null&&n.includes(r))}}),M=nt(((B=t.refs)==null?void 0:B.call(t,{prop:y,context:b}))??{}),N=()=>({state:C(),context:b,event:l(),prop:y,send:F,action:L,guard:A,track:ut,refs:M,computed:T,flush:G,scope:c,choose:O}),L=r=>{const e=z(r)?r(N()):r;if(!e)return;const n=e.map(u=>{var d,x;const a=(x=(d=t.implementations)==null?void 0:d.actions)==null?void 0:x[u];return a||U(`[zag-js] No implementation found for action "${JSON.stringify(u)}"`),a});for(const u of n)u==null||u(N())},A=r=>{var e,n;return z(r)?r(N()):(n=(e=t.implementations)==null?void 0:e.guards)==null?void 0:n[r](N())},I=r=>{const e=z(r)?r(N()):r;if(!e)return;const n=e.map(a=>{var x,p;const d=(p=(x=t.implementations)==null?void 0:x.effects)==null?void 0:p[a];return d||U(`[zag-js] No implementation found for effect "${JSON.stringify(a)}"`),d}),u=[];for(const a of n){const d=a==null?void 0:a(N());d&&u.push(d)}return()=>u.forEach(a=>a==null?void 0:a())},O=r=>tt(r).find(e=>{let n=!e.guard;return et(e.guard)?n=!!A(e.guard):z(e.guard)&&(n=e.guard(N())),n}),T=r=>{Z(t.computed,()=>"[zag-js] No computed object found on machine");const e=t.computed[r];return e({context:b,event:l(),prop:y,refs:M,scope:c,computed:T})},R=j(()=>({defaultValue:t.initialState({prop:y}),onChange(r,e){var u,a,d,x;if(e){const p=E.current.get(e);p==null||p(),E.current.delete(e)}e&&L((u=t.states[e])==null?void 0:u.exit),L((a=w.current)==null?void 0:a.actions);const n=I((d=t.states[r])==null?void 0:d.effects);if(n&&E.current.set(r,n),e===k){L(t.entry);const p=I(t.effects);p&&E.current.set(k,p)}L((x=t.states[r])==null?void 0:x.entry)}})),$=s.useRef(void 0),V=s.useRef(q.NotStarted);H(()=>{queueMicrotask(()=>{const n=V.current===q.Started;V.current=q.Started,f(n?"rehydrating...":"initializing...");const u=$.current??R.initial;R.invoke(u,n?R.get():k)});const r=E.current,e=R.ref.current;return()=>{f("unmounting..."),$.current=e,V.current=q.Stopped,r.forEach(n=>n==null?void 0:n()),E.current=new Map,w.current=null,queueMicrotask(()=>{L(t.exit)})}},[]);const Q=()=>"ref"in R?R.ref.current:R.get(),F=r=>{queueMicrotask(()=>{var x,p;if(V.current!==q.Started)return;g.current=i.current,i.current=r,f("send",r);let e=Q();const n=((x=t.states[e].on)==null?void 0:x[r.type])??((p=t.on)==null?void 0:p[r.type]),u=O(n);if(!u)return;w.current=u;const a=u.target??e;f("transition",u);const d=a!==e;d?P.flushSync(()=>R.set(a)):u.reenter&&!d?R.invoke(e,e):L(u.actions??[])})};return(D=t.watch)==null||D.call(t,N()),{state:C(),send:F,context:b,prop:y,scope:c,refs:M,computed:T,event:l(),getStatus:()=>V.current}}function K(t){const o=s.useRef(t);return o.current=t,o}function st(t){const o=K(t);return function(f){return o.current[f]}}function G(t){queueMicrotask(()=>{P.flushSync(()=>t())})}var pt=rt(t=>t);export{lt as L,Rt as a,gt as c,pt as n,dt as u};
