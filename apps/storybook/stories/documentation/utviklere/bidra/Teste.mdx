import { Alert, AlertIcon } from "@kvib/react/src";
import { Meta } from "@storybook/blocks";

<Meta title="For utviklere/Bidra med kode/Teste" />

# Teste komponenten

## Teste at komponenten bygges riktig i npm-pakken 游닍

Det er en god standard 친 teste @kvib/react-pakka f칮r release. Her er en kort oppskrift til hvordan du kan teste npm-pakken p친 din lokale maskin f칮r du opprettet PR og releaser.

1. Sett opp et prosjekt lokalt p친 maskinen din. Bruk for eksempel guidelines create-react-app, og sett eksempelvis opp et prosjekt under `~/Prosjekter/test-kvib-app`.

2. St친 i `kvib/packages/react` i den branchen du 칮nsker 친 teste, og kj칮r `npm run build`. Deretter kj칮r `npm pack --pack-destination <path til prosjektet der du 칮nsker 친 teste pakken>` . Det vil n친 dukke opp en pakke med navnet `kvib-react-x.x.x.tgz` p친 rot i test-prosjektet ditt.

3. I testprosjektet ditt i _package.json_ legg til denne linja under dependency: `"@kvib/react": "./kvib-react-x.x.x.tgz"`. Husk 친 oppdater versjonen s친 det stemmer overens med filnavnet p친 kvib-pakken

4. I test-prosjektet ditt. Kj칮r `npm install` eller `npm update` avhengig av om det f칮rste gang eller f칮lgende gang du legger til en kvib-pakke.

Kj칮r opp testappen din, wrap appen i `<KvibProvider/>` ogs친 er det bare 친 importere og sette i gang 친 teste komponenter!

Fin artikkel om akkurat dette: [Use npm pack to test your packages locally](https://dev.to/scooperdev/use-npm-pack-to-test-your-packages-locally-486e)

## UU-testing av komponenten 游댌

For 친 s칮rge for at komponentene vi lager overholder krav til universell utforming, m친 de testes for accessibility.
Designerne v친re tenker p친 UU n친r en komponenent blir designet, og Chakra tilbyr accessibility-features, blant annet A11y. Likevel har vi noen manuelle tester for komponenten f칮r den havner i designsystemet.

1. **Skjermleser**:Test hvordan komponenten oppf칮rer seg med skjermleser, eksempelvis NVDA. Det er s칝rlig viktig at tastatur-navigering fungerer korrekt.
2. **Zoom og skjermst칮rrelse**:Teste med 400% zoom p친 desktop, samt teste p친 sm친 skjermer. I storybook er det en egen funksjon som gj칮r at en kan teste hvordan komponenten ville sett ut p친 liten skjerm.
3. **a11y-synsnedsettelse**:I hver story kan det gjennomf칮res accessibility-tester for synet. Den finner du i menyen p친 toppen, merket med et accessibility-symbol. Test de ulike versjonene (Blurred vision, deutoranomaly, osv.) for 친 se om det er mulig 친 lese og forst친 hva komponenten gj칮r.

<img alt="navBar in story" src={"../../../../public/assets/navBarStory.png"} width="500px" />

<br />

4. **a11y-andre UU-tester**: I en story/komponent p친 dokumentasjonssiden er det en accessibility-fane, hvor det kontinuerlig og automatisk blir testet for accessibility gjennom a11y.
   Ved 친 klikke p친 fanen, f친r du en oversikt over testene som er gjort; b친de de godkjente og de som har brudd p친 krav. Alle testene m친 godkjennes f칮r en komponent kan bli lagt til i designsystemet.
   Dersom du ikke finner denne taben kan det v칝re fordi browseren ikke st칮tter alle funksjonene i storybook. Pr칮v 친 bruke Chrome eller Vivaldi browser.

<img alt="accessibility-test tab " src={"../../../../public/assets/tabsNavBarStory.png"} width="500px" />

5. **Test Runner**: Storybook sin Test Runner sjekker om storyene kj칮rer uten feil, og er derav ikke en direkte UU-test.
   Likevel er a11y konfigurert sammen med denne testen slik at det kj칮res som tester i Github Actions.
   Alle tester m친 derav godkjennes f칮r det er tillatt 친 merge til master. Dersom du 칮nsker 친 kj칮re test runner lokalt, 친pne termninalen og naviger til mappen `apps/storybook` og kj칮r her `npm run dev` for 친 kj칮re storybook.
   Videre mens storybook kj칮rer, 친pne en ny terminal, naviger til samme mappe og kj칮r `npm run test-storybook`. Testene vil da vises i terminalen.

6. Her er noen nyttige lenker som inneholder sjekklister for UU-testing av den spesifikke komponenten:

- [https://www.magentaa11y.com/web/](https://www.magentaa11y.com/web/)
- [https://a11y-101.com/development](https://a11y-101.com/development)
- [https://www.a11yproject.com/checklist/#appearance](https://www.a11yproject.com/checklist/#appearance)

  <Alert status="info">
    <AlertIcon />
    Det kan v칝re enkelte tilfeller hvor a11y-testene feiler p친 grunn av noe underliggende i Chakra. Det er mulig 친 overkj칮re
    reglene og testingen til a11y, men dette skal kun gj칮res dersom du ikke f친r endret det p친 noen annen m친te. Dersom du
    disabler en a11y-test pga en UU-feil vi ikke f친r rettet, m친 du dokumentere feilen i "Kjente feil" F칮lg [guiden til Storybook
    p친 hvordan konfigurere a11y](https://storybook.js.org/docs/react/writing-tests/accessibility-testing#configure). Se lister
    over [WCAG A & AA regel og regel beskrivelse](https://github.com/dequelabs/axe-core/blob/develop/doc/rule-descriptions.md)
    for 친 finne fram "Rule id" for konfigurasjon av a11y.
  </Alert>

## Bruke Chromatic for visuelle tester og interaksjonstesting

Ved 친 bruke [Chromatic](https://www.chromatic.com/builds?appId=636d64760ab19cb3a071bc48) f칮r publisering, kan vi utf칮re automatiske visuelle regresjonstester, oppdage eventuelle uventede endringer,
og s칮rge for at hvert nytt komponent samsvarer med v친re designstandarder.

N친r et komponent er ferdig og klart til 친 bli sjekket av designer, kan et nytt build bli publisert til Chromatic:

**Dette gj칮res ved 친 legge til `chromatic` som label i PRen.**

Dette vil trigge en Github Action som vil publisere til Chromatic. I tillegg blir det lagt til en pull request check som inneholder link til Chromatic.
Her m친 PRen godkjennes for at det skal v칝re mulig 친 merge den inn i master.

Sjekk ut [Chromatic Intro](https://kartverket.atlassian.net/l/cp/MtnkCR0K) for en intro til hvordan Chromatic fungerer for b친de designer- og utviklerrollen.
